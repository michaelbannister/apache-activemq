diff -uNr apache-activemq-5.3.2/bin/linux-x86-32/activemq apache-activemq-5.3.2p/bin/linux-x86-32/activemq
--- apache-activemq-5.3.2/bin/linux-x86-32/activemq	2010-04-27 00:23:58.000000000 +0200
+++ apache-activemq-5.3.2p/bin/linux-x86-32/activemq	2010-05-16 10:57:42.000000000 +0200
@@ -20,18 +20,18 @@
 # Application
 APP_NAME="ActiveMQ"
 APP_LONG_NAME="ActiveMQ Broker"
-ACTIVEMQ_HOME="../.."
+ACTIVEMQ_HOME="/usr/share/activemq"
 
 # Wrapper
-WRAPPER_CMD="wrapper"
-WRAPPER_CONF="wrapper.conf"
+WRAPPER_CMD="/usr/share/activemq/bin/linux/wrapper"
+WRAPPER_CONF="/etc/activemq/wrapper.conf"
 
 # Priority at which to run the wrapper.  See "man nice" for valid priorities.
 #  nice is only used if a priority is specified.
 PRIORITY=
 
 # Location of the pid file.
-PIDDIR="."
+PIDDIR="/var/run/activemq/"
 
 # If uncommented, causes the Wrapper to be shutdown using an anchor file.
 #  When launched with the 'start' command, it will also ignore all INT and
@@ -46,13 +46,18 @@
 # NOTE - This will set the user which is used to run the Wrapper as well as
 #  the JVM and is not useful in situations where a privileged resource or
 #  port needs to be allocated prior to the user being changed.
-#RUN_AS_USER=
+RUN_AS_USER=activemq
 
 # The following two lines are used by the chkconfig command. Change as is
 #  appropriate for your application.  They should remain commented.
 # chkconfig: 2345 20 80
 # description: @app.long.name@
 
+# load system-wide activemq configuration
+if [ -f "/etc/sysconfig/activemq" ] ; then
+  . /etc/sysconfig/activemq
+fi
+
 # Do not modify anything beyond this point
 #-----------------------------------------------------------------------------
 
@@ -308,7 +313,7 @@
                 RUN_AS_GROUP=`groups $RUN_AS_USER | awk '{print $3}' | tail -1`
                 if [ "X$RUN_AS_GROUP" = "X" ]
                 then
-                    RUN_AS_GROUP=RUN_AS_USER
+                    RUN_AS_GROUP=$RUN_AS_USER
                 fi
                 touch $LOCKFILE
                 chown $RUN_AS_USER:$RUN_AS_GROUP $LOCKFILE
diff -uNr apache-activemq-5.3.2/bin/linux-x86-64/activemq apache-activemq-5.3.2p/bin/linux-x86-64/activemq
--- apache-activemq-5.3.2/bin/linux-x86-64/activemq	2010-04-27 00:23:58.000000000 +0200
+++ apache-activemq-5.3.2p/bin/linux-x86-64/activemq	2010-05-16 10:57:49.000000000 +0200
@@ -20,18 +20,18 @@
 # Application
 APP_NAME="ActiveMQ"
 APP_LONG_NAME="ActiveMQ Broker"
-ACTIVEMQ_HOME="../.."
+ACTIVEMQ_HOME="/usr/share/activemq"
 
 # Wrapper
-WRAPPER_CMD="wrapper"
-WRAPPER_CONF="wrapper.conf"
+WRAPPER_CMD="/usr/lib/activemq/linux/wrapper"
+WRAPPER_CONF="/etc/activemq/wrapper.conf"
 
 # Priority at which to run the wrapper.  See "man nice" for valid priorities.
 #  nice is only used if a priority is specified.
 PRIORITY=
 
 # Location of the pid file.
-PIDDIR="."
+PIDDIR="/var/run/activemq/"
 
 # If uncommented, causes the Wrapper to be shutdown using an anchor file.
 #  When launched with the 'start' command, it will also ignore all INT and
@@ -46,13 +46,18 @@
 # NOTE - This will set the user which is used to run the Wrapper as well as
 #  the JVM and is not useful in situations where a privileged resource or
 #  port needs to be allocated prior to the user being changed.
-#RUN_AS_USER=
+RUN_AS_USER=activemq
 
 # The following two lines are used by the chkconfig command. Change as is
 #  appropriate for your application.  They should remain commented.
 # chkconfig: 2345 20 80
 # description: @app.long.name@
 
+# load system-wide activemq configuration
+if [ -f "/etc/sysconfig/activemq" ] ; then
+  . /etc/sysconfig/activemq
+fi
+
 # Do not modify anything beyond this point
 #-----------------------------------------------------------------------------
 
@@ -308,7 +313,7 @@
                 RUN_AS_GROUP=`groups $RUN_AS_USER | awk '{print $3}' | tail -1`
                 if [ "X$RUN_AS_GROUP" = "X" ]
                 then
-                    RUN_AS_GROUP=RUN_AS_USER
+                    RUN_AS_GROUP=$RUN_AS_USER
                 fi
                 touch $LOCKFILE
                 chown $RUN_AS_USER:$RUN_AS_GROUP $LOCKFILE
@@ -318,6 +323,7 @@
         # Still want to change users, recurse.  This means that the user will only be
         #  prompted for a password once.
         su -m $RUN_AS_USER -c "$REALPATH $1"
+        RETVAL=$?
 
         # Now that we are the original user again, we may need to clean up the lock file.
         if [ "X$LOCKPROP" != "X" ]
@@ -333,7 +339,7 @@
             fi
         fi
 
-        exit 0
+        exit $RETVAL
     fi
 }
 
